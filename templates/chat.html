<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />

    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.3.0/mdb.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../static/css/style.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <link rel="icon" href="{{ url_for('static', filename='images/favicon-16x16.png') }}">
</head>

<body id="corFundo">
    <nav id="navmenu" class="navbar navbar-expand-lg">
        <div class="container">
            <a href="/home" class="navbar-brand">
                <!---<img id="imglogo" src="{{ url_for('static', filename='images/cupom2.png') }}" />-->
                <img id="imglogo" src="../static/images/cupom2.png" />
            </a>
            <div class="input-group rounded">
                <input type="search" class="form-control rounded" placeholder="Pesquisar produtos" aria-label="Search"
                    aria-describedby="search-addon" />
                <span class="input-group-text border-0" id="search-addon">
                    <i class="fas fa-search"></i>
                </span>
            </div>
            <!---<a href="" ><img id="carrinho" src="{{ url_for('static', filename='images/pngtree-vector-cart-icon-png-image_1851515-removebg-preview.png') }}" /></a>--->
            <a style=" margin-top: 1%;" href="/chat"><img id="carrinho" src="../static/images/chatimg.png" /></a>

            <a style="margin-left: 4%" href="/postProduto"><img class="addPro" src="../static/images/add.png"
                    alt=""></a>
            <a href="/auth/login" style="margin-left: 2%">
                <img src="../static/images/iconuser.png" class="imgperfil" alt="">
            </a>

            <!---Colar um if se tiver logado muda para o p comentado abaixo-->
            <!--<p href="perfilUsuario.html" style="color: #fff;text-decoration:none; float: right; margin-left: 1%;">Olá (nome do usuario)</p>-->
            <a href="/auth/login" style="color: #fff;text-decoration:none; float: right; margin-left: 1%;">Entrar</a>


        </div>

    </nav>

    <div class="container" style="margin-top: 2%;">
        <div class="row clearfix">
            <div class="col-lg-12">
                <div class="card chat-app">

                    <!---Div da lista dos amigos-->
                    <div id="plist" class="lista-amigos">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span id="corFundo" style="color:#fff" class="input-group-text"><i
                                        class="fa fa-search"></i></span>
                            </div>
                            <input type="text" class="form-control" placeholder="Pesquisar...">
                        </div>
                        <ul class="list-unstyled chat-list mt-2 mb-0">
                            <li class="clearfix">
                                <img src="https://themusclemedics.com/wp-content/uploads/2018/04/Circle-Profile-PNG.png"
                                    alt="avatar">
                                <div class="about">
                                    <div class="name">Vinicius Mouro</div>
                                    <div class="status"> <i class="fa fa-circle offline"></i> offline</div>
                                </div>
                            </li>
                            <li class="clearfix active">
                                <img src="../static/images/perfil.jpg" alt="avatar">
                                <div class="about">
                                    <div class="name">Rodrigo Suares</div>
                                    <div class="status"> <i class="fa fa-circle online"></i> online </div>
                                </div>
                            </li>

                            <li class="clearfix">
                                <img src="https://www.pngkit.com/png/full/391-3919735_alicia-profile-photography.png"
                                    alt="avatar">
                                <div class="about">
                                    <div class="name">Fernanda Ribeiro</div>
                                    <div class="status"> <i class="fa fa-circle offline"></i> offline </div>
                                </div>
                            </li>
                            <li class="clearfix">
                                <img src="https://i.pinimg.com/280x280_RS/97/fb/92/97fb924ba856055f8bd711b082c80786.jpg"
                                    alt="avatar">
                                <div class="about">
                                    <div class="name">Helena Gomes</div>
                                    <div class="status"> <i class="fa fa-circle online"></i> online </div>
                                </div>
                            </li>
                            <li class="clearfix">
                                <img src="https://www.pngitem.com/pimgs/m/404-4042710_circle-profile-picture-png-transparent-png.png"
                                    alt="avatar">
                                <div class="about">
                                    <div class="name">Thiago Santos</div>
                                    <div class="status"> <i class="fa fa-circle online"></i> online </div>
                                </div>
                            </li>

                        </ul>
                    </div>

                    <!---Div do Chat-->
                    <div class="chat">
                        <div class="chat-header clearfix">
                            <div class="row">
                                <div class="col-lg-6">
                                    <a href="javascript:void(0);" data-toggle="modal" data-target="#view_info">
                                        <img src="../static/images/perfil.jpg" alt="avatar">
                                    </a>
                                    <div class="chat-sobre">
                                        <h6 class="m-b-0" style="padding-top:10px">Rodrigo Suares</h6>
                                    </div>
                                </div>
                                <div class="col-lg-6 hidden-sm text-right">
                                    <a href="javascript:void(0);" class="btn btn-outline-secondary"><i
                                            class="fa fa-camera"></i></a>
                                    <a href="javascript:void(0);" class="btn btn-outline-primary"><i
                                            class="fa fa-image"></i></a>
                                    <a href="javascript:void(0);" class="btn btn-outline-info"><i
                                            class="fa fa-cogs"></i></a>
                                    <a href="javascript:void(0);" class="btn btn-outline-warning"><i
                                            class="fa fa-question"></i></a>
                                </div>
                            </div>
                        </div>


                        <div class="campo-chat">


                            <!---Ul é responsavel pela ordenação das mensagens-->
                            <ul class="m-b-0">
                                <!---cada li é uma mensagem-->
                                <li class="clearfix">
                                    <div class="mensagem-box text-right">
                                        <span class="mensagem-box-tempo">Hoje 10:38</span>
                                        <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="avatar">
                                    </div>
                                    <div class="mensagem minha-mensagem float-right"> Olá tudo bom? me interessei pelo
                                        seu anuncío do Nintendo Switch </div>
                                </li>
                                <li class="clearfix">
                                    <div class="mensagem-box">
                                        <span class="mensagem-box-tempo">Hoje 10:43</span>
                                    </div>
                                    <div class="mensagem outro-mensagem">Oie, tudo ótimo sim e com você?</div>
                                </li>
                                <li class="clearfix">
                                    <div class="mensagem-box">
                                        <span class="mensagem-box-tempo">Hoje 10:45</span>
                                    </div>
                                    <div class="mensagem outro-mensagem">Então, esse Nintendo Switch está em ótimas
                                        condições de uso....</div>
                                </li>


                            </ul>

                        </div>
                        <!--Campo de escrita-->
                        <div class="chat-mensagem clearfix">
                            <div class="input-group mb-0">
                                <div class="input-group-prepend">
                                    <button type="submit" id="corFundo" style="color:#fff" class="input-group-text"><i
                                            class="fa fa-send"></i></button>
                                </div>
                                <input type="text" class="form-control" placeholder="Escreva alguma coisa aqui">
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Código do Chat -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
    <script>
        window.onload = function() {
            const socket = io('http://127.0.0.1:5000');

            function addToChat(msg) {
                const span = document.createElement("span");
                const chat = document.querySelector(".chat");
                span.innerHTML = `${msg.message}`;
                chat.append(span);
            }

            socket.on('connect', () => {
                socket.send('Usuário conectado ao socket!')
            });

            document.querySelector("form").addEventListener("submit", function(event) {
                event.preventDefault();

                socket.emit('sendMessage', {message: event.target[0].value});
                event.target[0].value = "";
            });

            socket.on('getMessage', (msg) => {
                addToChat(msg)
            });

            socket.on('message', (msgs) => {
                for(msg of msgs) {
                    addToChat(msg)
                }
            });
        }

    </script>

    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="../static/js/main.js"></script>
</body>

</html>